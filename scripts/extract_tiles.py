import os, sys
from PIL import Image

TILES = { "platforms" : [
	(0,0, 319,398,195,195),
	(0,1, 518,398,195,195),
	(0,2, 717,398,195,195),
	(0,3, 916,398,195,195),
	(0,4, 1115,398,195,195),

	(1,0, 319,677,195,195),
	(1,1, 518,677,195,195),
	(1,2, 717,677,195,195),
	(1,3, 916,677,195,195),
	(1,4, 1115,677,195,195),

	# support 1
	(2,0,197,970,195,195),
	(3,0,197,1168,195,195),
	(4,0,197,1367,195,195),

	#support 2
	(2,1,474,970,195,195),
	(3,1,474,1168,195,195),
	(4,1,474,1367,195,195),
	(2,2,671,969,195,195),
	(3,2,671,1168,195,195),
	(4,2,671,1367,195,195),

	# support 3
	(2,3,950,969,195,195),
	(3,3,950,1168,195,195),
	(4,3,950,1366,195,195),
	(2,4,1149,969,195,195),
	(3,4,1149,1168,195,195),
	(4,4,1149,1366,195,195),
	(2,5,1347,969,195,195),
	(3,5,1347,1168,195,195),
	(4,5,1347,1366,195,195),

	# ground
	(0,5,319,1657,195,195),
	(0,6,518,1657,195,195),
	(0,7,717,1657,195,195),
	(0,8,916,1657,195,195),
	(0,9,1115,1657,195,195),
	(1,5,319,1859,195,195),
	(1,6,518,1859,195,195),
	(1,7,717,1859,195,195),
	(1,8,916,1859,195,195),
	(1,9,1115,1859,195,195),
],

	"decorators" : [
		(2,6,159,342,195,195),
		(3,6,159,540,195,195),

		(2,7,425,342,195,195),
		(3,7,425,540,195,195),

		(2,8,156,759,195,195),
		(3,8,156,956,195,195),

		(4,6,392,765,195,195),

		(4,7,392,1003,195,195),

		(4,8,644,765,195,195),

		(4,9,644,1003,195,195),

		(2,9,901,765,195,195),

		(3,9,901,1003,195,195),

		(5,6,678,342,195,195),
		(5,7,877,342,195,195),
		(6,6,678,540,195,195),
		(6,7,877,540,195,195),

		(5,8,1138,342,195,195),
		(5,9,1337,342,195,195),

		(6,8,1138,600,195,195),
		(6,9,1337,600,195,195),

		(7,8,1138,868,195,195),
		(7,9,1337,868,195,195),

	]
};

if __name__=='__main__':

	name = sys.argv[2]
	world = sys.argv[1]

	# Add the "free space" block
	base = (189, 1268)
	for c in range(6):
		for r in range(4):
			TILES["decorators"].append( ( r+5, c, base[0] + c*199, base[1]+r*199, 195, 195 ) )


	outfile = world + "_" + name + "_tilemap.png"

	
	outimg = Image.new( 'RGBA', (1000, 1100))
	for tilesheet, tilesheetTiles in TILES.iteritems():

		srcimgfile = world + "_" + name + "_" + tilesheet + "_scan2.png"
		print srcimgfile		

		srcimg = Image.open( srcimgfile )

		for tileinfo in tilesheetTiles:

			row, col, x, y, w, h = tileinfo
			tile = srcimg.crop( (x, y, x+w, y+h) )
			tile = tile.resize( (100, 100),  Image.ANTIALIAS )

			# tile.save( "test%d%d.png" % (row, col) )

			outimg.paste( tile, (col*100, row*100))

	outimg.save( outfile )
